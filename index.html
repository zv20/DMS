<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Summernote Editor (100% Free, No API Key) -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçΩÔ∏è Recipe Manager</h1>
            <div class="header-controls">
                <div id="syncStatus" class="sync-status disconnected" data-i18n="sync_disconnected">Not Connected</div>
                <select id="languageSelect" onchange="changeLanguage(this.value)">
                    <option value="en">English</option>
                    <option value="bg">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
                </select>
            </div>
        </header>

        <nav>
            <button class="nav-btn active" data-page="recipes" data-i18n="nav_recipes">Recipes</button>
            <button class="nav-btn" data-page="ingredients" data-i18n="nav_ingredients">Ingredients</button>
            <button class="nav-btn" data-page="allergens" data-i18n="nav_allergens">Allergens</button>
            <button class="nav-btn" data-page="menu" data-i18n="nav_menu">Menu Planning</button>
            <button class="nav-btn" data-page="template" data-i18n="nav_template">Print Template</button>
        </nav>

        <!-- File System Controls -->
        <div class="file-controls">
            <button class="btn btn-primary" onclick="selectSaveLocation()" data-i18n="btn_select_location">üìÅ Select Save Location</button>
            <button class="btn btn-secondary" onclick="manualSave()" data-i18n="btn_manual_save">üíæ Save</button>
            <button class="btn btn-secondary" onclick="manualLoad()" data-i18n="btn_manual_load">üìÇ Load from Folder</button>
            <button class="btn btn-secondary" onclick="exportData()" data-i18n="btn_export">Export</button>
            <button class="btn btn-secondary" onclick="importData()" data-i18n="btn_import">Import</button>
            <!-- Hidden file input for import -->
            <input type="file" id="importInput" accept=".json" style="display:none;">
            <button class="btn btn-secondary" onclick="document.getElementById('importInput').click()" data-i18n="btn_import">Import</button>
        </div>

        <!-- Recipes Page -->
        <div id="recipes" class="page active">
            <div class="page-header">
                <h2 data-i18n="nav_recipes">Recipes</h2>
                <button class="btn btn-primary" onclick="openRecipeModal()" data-i18n="btn_add_recipe">+ Add Recipe</button>
            </div>
            <div id="recipeList" class="card-grid"></div>
        </div>

        <!-- Ingredients Page -->
        <div id="ingredients" class="page">
            <div class="page-header">
                <h2 data-i18n="nav_ingredients">Ingredients</h2>
                <button class="btn btn-primary" onclick="openIngredientModal()" data-i18n="btn_add_ingredient">+ Add Ingredient</button>
            </div>
            <div id="ingredientList" class="card-grid"></div>
        </div>

        <!-- Allergens Page -->
        <div id="allergens" class="page">
            <div class="page-header">
                <h2 data-i18n="nav_allergens">Allergens</h2>
                <button class="btn btn-primary" onclick="openAllergenModal()" data-i18n="btn_add_allergen">+ Add Allergen</button>
            </div>
            <div id="allergenList" class="card-grid"></div>
        </div>

        <!-- Menu Planning Page -->
        <div id="menu" class="page">
            <div class="page-header">
                <h2 data-i18n="nav_menu">Menu Planning</h2>
                <div class="menu-controls">
                    <button class="btn btn-secondary" onclick="toggleView('week')" data-i18n="btn_week_view">üìÖ Week View</button>
                    <button class="btn btn-secondary" onclick="toggleView('month')" data-i18n="btn_month_view">üìÜ Month View</button>
                    <button class="btn btn-primary" onclick="saveCurrentMenu()" data-i18n="btn_save_menu">Save Menu</button>
                </div>
            </div>

            <!-- Print Controls -->
            <div style="background:var(--color-surface);padding:1rem;border-radius:var(--border-radius);margin-bottom:1.5rem;box-shadow:var(--shadow-sm);">
                <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center;justify-content:space-between;">
                    <div style="display:flex;align-items:center;gap:0.5rem;">
                        <label style="font-size:0.9rem;font-weight:bold;" data-i18n="label_print_date">Print Week of:</label>
                        <input type="date" id="printStartDate" class="btn btn-secondary" style="border:1px solid #ddd;padding:0.4rem;">
                    </div>
                    
                    <button class="btn btn-primary" onclick="printMenu()" data-i18n="btn_print">üñ®Ô∏è Print Menu</button>
                </div>
                <p style="margin:0.75rem 0 0 0;font-size:0.875rem;color:var(--color-text-secondary);" data-i18n="text_print_hint">
                    üí° Only days with planned meals will be printed. Use the date picker to switch weeks.
                </p>
            </div>

            <div class="calendar-header">
                <button class="btn btn-secondary" onclick="changeMonth(-1)" data-i18n="btn_previous">‚Üê Previous</button>
                <h3 id="currentMonth"></h3>
                <button class="btn btn-secondary" onclick="changeMonth(1)" data-i18n="btn_next">Next ‚Üí</button>
            </div>
            <div id="calendar" class="calendar"></div>

            <div class="menu-history-section">
                <h3 data-i18n="heading_past_menus">Past Menus</h3>
                <div id="menuHistory"></div>
            </div>
        </div>

        <!-- Print Template Page -->
        <div id="template" class="page">
            <div class="page-header">
                <h2 data-i18n="nav_template">Print Template Designer</h2>
                <button class="btn btn-primary" onclick="saveTemplate()" data-i18n="btn_save_template">Save Template</button>
            </div>

            <div class="template-editor-container">
                <div class="template-editor-section">
                    <h3 data-i18n="modal_edit_recipe">Template Editor</h3>
                    <p style="color:var(--color-text-secondary);font-size:0.9rem;margin-bottom:0.5rem;" data-i18n="template_description">
                        Customize your menu print template. Insert variables using the buttons below:
                    </p>

                    <div style="background:#e3f2fd;padding:1rem;border-radius:var(--border-radius);margin-bottom:1rem;border-left:4px solid var(--color-primary);">
                        <h4 style="margin:0 0 0.5rem 0;color:var(--color-primary);">üìù Available Variables:</h4>
                        <ul style="margin:0;padding-left:1.5rem;font-size:0.875rem;line-height:1.8;">
                            <li><code>{title}</code> - Menu title with date range</li>
                            <li><code>{dateRange}</code> - Selected date range</li>
                            <li><code>{labelMenuFor}</code> - "Menu for:" label</li>
                            <li><code>{recipes}</code> - <strong>All recipes organized by day and meal type</strong></li>
                        </ul>
                    </div>

                    <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
                        <button class="btn btn-small btn-secondary" onclick="insertVariable('{title}')">Insert {title}</button>
                        <button class="btn btn-small btn-secondary" onclick="insertVariable('{dateRange}')">Insert {dateRange}</button>
                        <button class="btn btn-small btn-secondary" onclick="insertVariable('{labelMenuFor}')">Insert {labelMenuFor}</button>
                        <button class="btn btn-small btn-primary" onclick="insertVariable('{recipes}')">Insert {recipes}</button>
                    </div>

                    <div id="templateEditor"></div>

                    <div style="margin-top:1.5rem;">
                        <h4 data-i18n="label_layout">Layout Style</h4>
                        <div style="display:flex;gap:0.5rem;margin-top:0.5rem;flex-wrap:wrap;">
                            <button class="btn btn-small btn-secondary layout-btn active" onclick="setLayout('default')" id="layout_default" data-i18n="btn_layout_default">üìÑ Default</button>
                            <button class="btn btn-small btn-secondary layout-btn" onclick="setLayout('columns')" id="layout_columns" data-i18n="btn_layout_columns">üì∞ Two Columns</button>
                            <button class="btn btn-small btn-secondary layout-btn" onclick="setLayout('centered')" id="layout_centered" data-i18n="btn_layout_centered">‚≠ê Centered</button>
                             <button class="btn btn-small btn-secondary layout-btn" onclick="setLayout('grid')" id="layout_grid" data-i18n="btn_layout_grid">üìÖ 5-Day Grid</button>
                        </div>
                    </div>

                    <div style="margin-top:1.5rem;">
                        <h4 data-i18n="label_background">Background Image</h4>
                        <div style="display:flex;gap:0.5rem;margin-top:0.5rem;flex-wrap:wrap;">
                            <button class="btn btn-small btn-secondary" onclick="document.getElementById('uploadBgInput').click()" data-i18n="btn_upload_bg">üñºÔ∏è Upload Background</button>
                            <input type="file" id="uploadBgInput" accept="image/*" style="display:none;">
                            <button class="btn btn-small btn-danger" id="removeBgBtn" onclick="removeBackgroundImage()" data-i18n="btn_remove_bg">‚úñ Remove Background</button>
                        </div>
                    </div>
                </div>

                <div class="template-preview-section">
                    <h3 data-i18n="heading_preview">Preview</h3>
                    <div id="templatePreview" class="template-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recipe Modal -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="recipeModalTitle" data-i18n="modal_add_recipe">Add Recipe</h2>
                <button class="modal-close" onclick="closeRecipeModal()">&times;</button>
            </div>
            <form id="recipeForm" onsubmit="saveRecipe(event)">
                <div class="form-group">
                    <label for="recipeName" data-i18n="label_recipe_name">Recipe Name</label>
                    <input type="text" id="recipeName" required>
                </div>

                <div class="form-group">
                    <label for="recipeCategory" data-i18n="label_category">Category</label>
                    <select id="recipeCategory" required>
                        <option value="" data-i18n="category_select">Select category</option>
                        <option value="soup" data-i18n="category_soup">ü•£ Soup</option>
                        <option value="main" data-i18n="category_main">üçΩÔ∏è Main</option>
                        <option value="dessert" data-i18n="category_dessert">üç∞ Dessert</option>
                        <option value="other" data-i18n="category_other">‚ûï Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="recipePortionSize" data-i18n="label_portion_size">Portion Size (optional)</label>
                    <input type="text" id="recipePortionSize" placeholder="e.g., Serves 10, 250g per serving">
                </div>

                <div class="form-group">
                    <label data-i18n="label_ingredients">Ingredients</label>
                    <div style="display:flex;gap:0.5rem;margin-bottom:0.5rem;">
                        <select id="ingredientSelect" style="flex:1;">
                            <option value="" data-i18n="select_ingredient">Select ingredient</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="addIngredientToRecipe()" data-i18n="btn_add">Add</button>
                    </div>
                    <div id="recipeIngredients" class="tag-container"></div>
                </div>

                <div class="form-group">
                    <label data-i18n="label_allergens">Allergens</label>
                    <div style="display:flex;gap:0.5rem;margin-bottom:0.5rem;">
                        <select id="allergenSelect" style="flex:1;">
                            <option value="" data-i18n="select_allergen">Select allergen</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="addAllergenToRecipe()" data-i18n="btn_add">Add</button>
                    </div>
                    <div id="recipeAllergens" class="tag-container"></div>
                </div>

                <div class="form-group">
                    <label for="recipeInstructions" data-i18n="label_instructions">Instructions (optional)</label>
                    <textarea id="recipeInstructions" rows="4"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeRecipeModal()" data-i18n="btn_cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_save_recipe">Save Recipe</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ingredient Modal -->
    <div id="ingredientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="modal_add_ingredient">Add Ingredient</h2>
                <button class="modal-close" onclick="closeIngredientModal()">&times;</button>
            </div>
            <form id="ingredientForm" onsubmit="saveIngredient(event)">
                <div class="form-group">
                    <label for="ingredientName" data-i18n="label_ingredient_name">Ingredient Name</label>
                    <input type="text" id="ingredientName" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeIngredientModal()" data-i18n="btn_cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_add">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Allergen Modal -->
    <div id="allergenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="modal_add_allergen">Add Allergen</h2>
                <button class="modal-close" onclick="closeAllergenModal()">&times;</button>
            </div>
            <form id="allergenForm" onsubmit="saveAllergen(event)">
                <div class="form-group">
                    <label for="allergenName" data-i18n="label_allergen_name">Allergen Name</label>
                    <input type="text" id="allergenName" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAllergenModal()" data-i18n="btn_cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_add">Add</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>