<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KitchenPro DMS</title>
  
  <link rel="stylesheet" href="css/styles.css?v=10.4">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600&display=swap" rel="stylesheet">
  
  <script src="js/i18n.js?v=10.4"></script>
  <script src="js/utils.js?v=10.4"></script>
  <script src="js/store.js?v=10.4"></script>
  <script src="js/calendar.js?v=10.4"></script>
  <script src="js/render.js?v=10.4"></script>
  <script src="js/ui.js?v=10.4"></script>
  <script src="js/template.js?v=10.4"></script>
  <script src="js/main.js?v=10.4"></script>
</head>
<body data-theme="default">

  <!-- Splash Screen -->
  <div id="splashScreen" class="splash-screen">
      <div class="splash-content">
          <span class="splash-logo">üçΩÔ∏è</span>
          <h1 class="splash-title">KitchenPro</h1>
          <p class="splash-subtitle">Your personal recipe manager & menu planner</p>
          <div id="splashActions" class="splash-actions">
              <div class="loader-spinner"></div>
          </div>
      </div>
  </div>

  <!-- Header -->
  <header class="app-header">
      <div style="display:flex; align-items:center; gap:1rem;">
          <button id="hamburgerBtn" class="hamburger-btn" aria-label="Open Menu">
              <span></span>
              <span></span>
              <span></span>
          </button>
          <div class="logo" style="margin-left: 50px;">
            <h2>üçΩÔ∏è KitchenPro</h2>
          </div>
      </div>
      <div class="header-right">
           <div id="syncIndicator" class="sync-indicator sync-hidden" title="Saved">‚úì</div>
           <select id="languageSelect" class="lang-select-minimal">
              <option value="en">üá∫üá∏</option>
              <option value="bg">üáßüá¨</option>
           </select>
      </div>
  </header>

  <!-- Navigation Overlay -->
  <div id="navOverlay" class="nav-overlay">
      <button id="closeNavBtn" class="close-nav-btn">&times;</button>
      <div class="nav-content">
          <div class="nav-links">
              <button class="nav-item active" data-page="menu" data-i18n="nav_menu">Menu Planner</button>
              <div class="nav-separator"></div>
              <button class="nav-item" data-page="recipes" data-i18n="nav_recipes">Recipes</button>
              <button class="nav-item" data-page="ingredients" data-i18n="nav_ingredients">Ingredients</button>
              <button class="nav-item" data-page="allergens" data-i18n="nav_allergens">Allergens</button>
              <div class="nav-separator"></div>
              <button class="nav-item" data-page="settings" data-i18n="nav_settings">‚öôÔ∏è Settings</button>
          </div>
      </div>
  </div>

  <div class="app-container">
    <main class="content">

      <!-- MENU PLANNING PAGE -->
      <div id="menu" class="page active">
        <div class="page-header">
          <h1 data-i18n="nav_menu">Menu Planning</h1>
          <div class="actions">
             <button class="btn btn-secondary" onclick="window.navigateTo('style-editor')" data-i18n="btn_customize">üìù Template Builder</button>
             <button class="btn btn-primary" onclick="window.openTemplatePicker()" data-i18n="btn_print">üñ®Ô∏è Print Menu</button>
          </div>
        </div>
        
        <!-- View Switcher & Calendar Controls -->
        <div class="calendar-controls">
           <div style="display: flex; gap: 10px;">
               <button class="btn btn-secondary active" id="monthlyViewBtn">üìÜ Monthly</button>
               <button class="btn btn-secondary" id="weeklyViewBtn">üìÖ Weekly</button>
           </div>
           <div style="display: flex; align-items: center; gap: 10px;">
               <button class="btn btn-secondary" onclick="window.changeMonth(-1)">‚Üê</button>
               <h2 id="currentMonth" style="margin: 0; min-width: 200px; text-align: center;">...</h2>
               <button class="btn btn-secondary" onclick="window.changeMonth(1)">‚Üí</button>
           </div>
        </div>
        
        <div id="calendar" class="week-view"></div>
      </div>

      <!-- RECIPES PAGE -->
      <div id="recipes" class="page">
        <div class="page-header">
          <h1 data-i18n="nav_recipes">Recipes</h1>
          <button class="btn btn-primary" onclick="window.openRecipeModal()">+ Add Recipe</button>
        </div>
        <div class="table-responsive">
            <table class="list-table">
                <thead>
                    <tr>
                        <th data-i18n="label_recipe_name">Name</th>
                        <th data-i18n="label_category">Category</th>
                        <th data-i18n="label_portion_size">Portion</th>
                        <th data-i18n="label_allergens">Allergens</th>
                        <th data-i18n="table_actions">Actions</th>
                    </tr>
                </thead>
                <tbody id="recipeList"></tbody>
            </table>
        </div>
      </div>

      <!-- INGREDIENTS PAGE -->
      <div id="ingredients" class="page">
        <div class="page-header">
          <h1 data-i18n="nav_ingredients">Ingredients</h1>
          <button class="btn btn-primary" onclick="window.openIngredientModal()">+ Add Ingredient</button>
        </div>
        <div class="table-responsive">
            <table class="list-table">
                <thead>
                    <tr>
                        <th data-i18n="label_ingredient_name">Name</th>
                        <th data-i18n="label_allergens">Allergens</th>
                        <th data-i18n="table_actions">Actions</th>
                    </tr>
                </thead>
                <tbody id="ingredientList"></tbody>
            </table>
        </div>
      </div>

      <!-- ALLERGENS PAGE -->
      <div id="allergens" class="page">
        <div class="page-header">
          <h1 data-i18n="nav_allergens">Allergens</h1>
          <button class="btn btn-primary" onclick="window.openAllergenModal()">+ Add Allergen</button>
        </div>
        <div class="table-responsive">
            <table class="list-table">
                <thead>
                    <tr>
                        <th data-i18n="label_allergen_name">Name</th>
                        <th data-i18n="label_color">Color</th>
                        <th data-i18n="table_actions">Actions</th>
                    </tr>
                </thead>
                <tbody id="allergenList"></tbody>
            </table>
        </div>
      </div>

      <!-- SETTINGS PAGE -->
      <div id="settings" class="page">
          <div class="page-header"><h1>Settings</h1></div>
          <div class="settings-card">
              <h3>üíæ Data</h3>
              <button class="btn btn-primary" onclick="window.selectSaveLocation()">Change Storage Folder</button>
          </div>
      </div>

      <!-- TEMPLATE BUILDER PAGE -->
      <div id="style-editor" class="page">
        <div class="page-header">
          <button class="btn btn-secondary btn-small" onclick="window.navigateTo('menu')">‚Üê Back to Menu</button>
          <h1>Template Builder</h1>
          <div class="actions">
              <button class="btn btn-primary" onclick="window.saveCurrentTemplate()">Save as New</button>
          </div>
        </div>
        
        <div class="builder-layout" style="display: grid; grid-template-columns: 400px 1fr; gap: 20px; min-height: calc(100vh - 150px);">
             <!-- LEFT PANEL: Controls -->
             <div class="builder-controls" style="overflow-y: auto; padding: 20px; background: white; border-radius: 8px; height: fit-content; max-height: calc(100vh - 180px);">
                  
                  <!-- Template Library -->
                  <section class="control-section">
                      <h3>üìã Template Library</h3>
                      <div id="templateLibrary" style="display:flex; flex-direction:column; gap:8px; margin-top:10px;"></div>
                  </section>

                  <!-- Background Image -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üñºÔ∏è Background</h3>
                      <label>Image URL (optional)</label>
                      <input type="text" id="backgroundImage" class="form-control" placeholder="https://example.com/image.jpg">
                      <small style="color:#666; font-size:0.85rem; display:block; margin-top:5px;">
                          <strong>Recommended size:</strong> 2480 x 3508 px (A4 at 300 DPI)<br>
                          <strong>Or:</strong> 1654 x 2339 px (A4 at 200 DPI)<br>
                          Leave blank for no background
                      </small>
                  </section>

                  <!-- Header Settings -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üîù Header</h3>
                      <label>Title</label>
                      <input type="text" id="headerText" class="form-control" placeholder="Weekly Menu" value="Weekly Menu">
                      
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                          <div>
                              <label>Color</label>
                              <input type="color" id="headerColor" value="#fd7e14" style="width:100%;">
                          </div>
                          <div>
                              <label>Font Size</label>
                              <input type="text" id="headerSize" class="form-control" value="20pt">
                          </div>
                      </div>
                      
                      <label style="margin-top:10px;">Font Weight</label>
                      <select id="headerWeight" class="form-control">
                          <option value="normal">Normal</option>
                          <option value="600">Semi-Bold</option>
                          <option value="bold" selected>Bold</option>
                      </select>
                  </section>

                  <!-- Day Block Styling -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üìÖ Day Block Style</h3>
                      <label>Background Color</label>
                      <input type="color" id="dayBg" value="#ffffff" style="width:100%;">
                      
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                          <div>
                              <label>Border Radius (px)</label>
                              <input type="number" id="dayRadius" value="8" class="form-control">
                          </div>
                          <div>
                              <label>Border Width (px)</label>
                              <input type="number" id="dayBorderWidth" value="2" min="0" max="10" class="form-control">
                          </div>
                      </div>
                      
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                          <div>
                              <label>Border Color</label>
                              <input type="color" id="dayBorderColor" value="#e0e0e0" style="width:100%;">
                          </div>
                          <div>
                              <label>Border Style</label>
                              <select id="dayBorderStyle" class="form-control">
                                  <option value="solid">Solid</option>
                                  <option value="dashed">Dashed</option>
                                  <option value="dotted">Dotted</option>
                                  <option value="double">Double</option>
                              </select>
                          </div>
                      </div>
                  </section>

                  <!-- Day Name Styling -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üìå Day Name Style</h3>
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                          <div>
                              <label>Font Size</label>
                              <input type="text" id="dayNameSize" class="form-control" value="11pt">
                          </div>
                          <div>
                              <label>Color</label>
                              <input type="color" id="dayNameColor" value="#2c3e50" style="width:100%;">
                          </div>
                      </div>
                      <label style="margin-top:10px;">Font Weight</label>
                      <select id="dayNameWeight" class="form-control">
                          <option value="normal">Normal</option>
                          <option value="500">Medium</option>
                          <option value="600" selected>Semi-Bold</option>
                          <option value="bold">Bold</option>
                      </select>
                  </section>

                  <!-- Meal Title Styling -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üçΩÔ∏è Meal Title Style</h3>
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                          <div>
                              <label>Font Size</label>
                              <input type="text" id="mealTitleSize" class="form-control" value="9pt">
                          </div>
                          <div>
                              <label>Color</label>
                              <input type="color" id="mealTitleColor" value="#333333" style="width:100%;">
                          </div>
                      </div>
                      <label style="margin-top:10px;">Font Weight</label>
                      <select id="mealTitleWeight" class="form-control">
                          <option value="normal">Normal</option>
                          <option value="500">Medium</option>
                          <option value="600" selected>Semi-Bold</option>
                          <option value="bold">Bold</option>
                      </select>
                  </section>

                  <!-- Ingredients Styling -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üßÇ Ingredients Style</h3>
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                          <div>
                              <label>Font Size</label>
                              <input type="text" id="ingredientsSize" class="form-control" value="7.5pt">
                          </div>
                          <div>
                              <label>Color</label>
                              <input type="color" id="ingredientsColor" value="#555555" style="width:100%;">
                          </div>
                      </div>
                      <label style="margin-top:10px;">Font Style</label>
                      <select id="ingredientsStyle" class="form-control">
                          <option value="normal">Normal</option>
                          <option value="italic" selected>Italic</option>
                      </select>
                  </section>

                  <!-- Meal Block Settings -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üç≤ Meal Visibility</h3>
                      
                      <div class="meal-type-config" style="border:1px solid #ddd; padding:10px; border-radius:6px; margin-bottom:10px;">
                          <h4 style="margin:0 0 10px 0; color:#fd7e14; font-size:10pt;">ü•£ Soup (Slot 1)</h4>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot1_showIngredients" checked> Show Ingredients</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot1_showCalories" checked> Show Calories</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot1_showAllergens" checked> Highlight Allergens</label>
                      </div>

                      <div class="meal-type-config" style="border:1px solid #ddd; padding:10px; border-radius:6px; margin-bottom:10px;">
                          <h4 style="margin:0 0 10px 0; color:#fd7e14; font-size:10pt;">üçΩÔ∏è Main (Slot 2)</h4>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot2_showIngredients" checked> Show Ingredients</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot2_showCalories" checked> Show Calories</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot2_showAllergens" checked> Highlight Allergens</label>
                      </div>

                      <div class="meal-type-config" style="border:1px solid #ddd; padding:10px; border-radius:6px; margin-bottom:10px;">
                          <h4 style="margin:0 0 10px 0; color:#fd7e14; font-size:10pt;">üç∞ Dessert (Slot 3)</h4>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot3_showIngredients" checked> Show Ingredients</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot3_showCalories" checked> Show Calories</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot3_showAllergens" checked> Highlight Allergens</label>
                      </div>

                      <div class="meal-type-config" style="border:1px solid #ddd; padding:10px; border-radius:6px; margin-bottom:10px;">
                          <h4 style="margin:0 0 10px 0; color:#fd7e14; font-size:10pt;">‚ûï Other (Slot 4)</h4>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot4_showIngredients" checked> Show Ingredients</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot4_showCalories" checked> Show Calories</label><br>
                          <label style="font-size:9pt;"><input type="checkbox" id="slot4_showAllergens" checked> Highlight Allergens</label>
                      </div>
                  </section>

                  <!-- Footer Settings -->
                  <section class="control-section" style="margin-top:20px;">
                      <h3>üîö Footer</h3>
                      <label>Text</label>
                      <textarea id="footerText" class="form-control" rows="2" placeholder="Additional notes...">Prepared with care by KitchenPro</textarea>
                      
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                          <div>
                              <label>Font Size</label>
                              <input type="text" id="footerSize" class="form-control" value="8pt">
                          </div>
                          <div>
                              <label>Color</label>
                              <input type="color" id="footerColor" value="#7f8c8d" style="width:100%;">
                          </div>
                      </div>
                  </section>
             </div>

             <!-- RIGHT PANEL: Live Preview -->
             <div class="builder-preview-area" style="background: #e9ecef; display: flex; justify-content: center; padding: 20px; overflow-y: auto;">
                  <div id="livePreviewSheet" style="width: 210mm; min-height: 297mm; background: white; padding: 20mm; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                       <div id="previewHeader"></div>
                       <div id="previewDaysList"></div>
                       <div id="previewFooter"></div>
                  </div>
             </div>
        </div>
      </div>

    </main>
  </div>

  <!-- MODALS -->
  <div id="templatePickerModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="document.getElementById('templatePickerModal').style.display='none'">&times;</span>
          <h2>Print Menu</h2>
          <div id="templateGrid" style="margin-top:20px;"></div>
      </div>
  </div>

  <div id="recipeModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="window.closeRecipeModal()">&times;</span>
          <h2 id="recipeModalTitle">Add Recipe</h2>
          <form id="recipeForm" onsubmit="window.saveRecipe(event)">
              <label data-i18n="label_recipe_name">Recipe Name</label>
              <input type="text" id="recipeName" class="form-control" required placeholder="Recipe Name">
              
              <label data-i18n="label_category">Category</label>
              <select id="recipeCategory" class="form-control"></select>
              
              <label data-i18n="label_portion_size">Portion Size</label>
              <input type="text" id="recipePortionSize" class="form-control" placeholder="e.g., 250g">
              
              <label>Calories (optional)</label>
              <input type="number" id="recipeCalories" class="form-control" placeholder="e.g., 220">
              
              <label data-i18n="label_ingredients">Ingredients</label>
              <div style="display:flex; gap:5px; margin-bottom:10px;">
                  <select id="ingredientSelect" class="form-control" style="flex:1;"></select>
                  <button type="button" class="btn btn-secondary" onclick="window.addIngredientFromSelect()">Add</button>
              </div>
              <div id="recipeIngredients" class="tag-container" style="margin-bottom:15px;"></div>
              
              <label>Auto-detected Allergens</label>
              <div id="recipeAutoAllergens" style="margin-bottom:15px; padding:10px; background:#f8f9fa; border-radius:4px; min-height:30px;">-</div>
              
              <label data-i18n="label_manual_allergens">Manual Allergens</label>
              <div style="display:flex; gap:5px; margin-bottom:10px;">
                  <select id="allergenSelect" class="form-control" style="flex:1;"></select>
                  <button type="button" class="btn btn-secondary" onclick="window.addAllergenFromSelect()">Add</button>
              </div>
              <div id="recipeManualAllergens" class="tag-container" style="margin-bottom:15px;"></div>
              
              <label data-i18n="label_instructions">Instructions</label>
              <textarea id="recipeInstructions" class="form-control" rows="4" placeholder="Cooking instructions..."></textarea>
              
              <div style="margin-top:20px;">
                  <button type="submit" class="btn btn-primary">Save Recipe</button>
                  <button type="button" class="btn btn-secondary" onclick="window.closeRecipeModal()">Cancel</button>
              </div>
          </form>
      </div>
  </div>

  <div id="ingredientModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="window.closeIngredientModal()">&times;</span>
      <h2 id="ingredientModalTitle">Add Ingredient</h2>
      <form id="ingredientForm" onsubmit="window.saveIngredient(event)">
        <label data-i18n="label_ingredient_name">Ingredient Name</label>
        <input type="text" id="ingredientName" class="form-control" required placeholder="Ingredient Name">
        
        <label data-i18n="label_allergens">Allergens</label>
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <select id="ingredientAllergenSelect" class="form-control" style="flex:1;"></select>
            <button type="button" class="btn btn-secondary" onclick="window.addIngredientAllergenFromSelect()">Add</button>
        </div>
        <div id="ingredientLinkedAllergens" class="tag-container" style="margin-bottom:15px;"></div>
        
        <div style="margin-top:20px;">
            <button type="submit" class="btn btn-primary">Save Ingredient</button>
            <button type="button" class="btn btn-secondary" onclick="window.closeIngredientModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="allergenModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="window.closeAllergenModal()">&times;</span>
      <h2 id="allergenModalTitle">Add Allergen</h2>
      <form id="allergenForm" onsubmit="window.saveAllergen(event)">
        <label data-i18n="label_allergen_name">Allergen Name</label>
        <input type="text" id="allergenName" class="form-control" required placeholder="Allergen Name">
        
        <label data-i18n="label_color">Color</label>
        <input type="color" id="allergenColor" class="form-control" value="#3498db">
        
        <div style="margin-top:20px;">
            <button type="submit" class="btn btn-primary">Save Allergen</button>
            <button type="button" class="btn btn-secondary" onclick="window.closeAllergenModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

</body>
</html>
