<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Manager & Menu Planner</title>
  
  <!-- Summernote CSS -->
  <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-lite.min.css" rel="stylesheet">
  
  <style>
    :root {
      --color-primary: #21808d;
      --color-secondary: #f0f7f8;
      --color-accent: #e67e22;
      --color-text-primary: #2c3e50;
      --color-text-secondary: #7f8c8d;
      --color-border: #ecf0f1;
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --radius-sm: 6px;
      --radius-md: 10px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: var(--color-text-primary);
    }

    /* Header & Navigation */
    header {
      background-color: #fff;
      padding: 1rem 2rem;
      box-shadow: var(--shadow-sm);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .brand {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-tabs {
      display: flex;
      gap: 0.5rem;
    }

    .nav-btn {
      padding: 0.6rem 1.2rem;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-text-secondary);
      border-radius: var(--radius-sm);
      transition: all 0.2s;
    }

    .nav-btn:hover {
      background-color: var(--color-secondary);
      color: var(--color-primary);
    }

    .nav-btn.active {
      background-color: var(--color-primary);
      color: white;
    }

    .controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Sync Dropdown */
    .sync-dropdown {
      position: relative;
      display: inline-block;
    }

    .sync-status {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s;
    }

    .sync-status:hover {
      background-color: #f0f0f0;
      border-color: #ddd;
    }

    .sync-status.connected { background-color: #e6fcf5; color: #0ca678; }
    .sync-status.disconnected { background-color: #fff9db; color: #f59f00; }
    .sync-status.error { background-color: #fff5f5; color: #fa5252; }

    .sync-dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 110%;
      background-color: white;
      min-width: 220px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      border-radius: var(--radius-sm);
      z-index: 200;
      overflow: hidden;
      border: 1px solid #eee;
    }

    .sync-dropdown.show .sync-dropdown-content {
      display: block;
    }

    .sync-dropdown-content button {
      width: 100%;
      text-align: left;
      padding: 12px 16px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      color: #333;
      border-bottom: 1px solid #f5f5f5;
    }

    .sync-dropdown-content button:hover {
      background-color: #f8f9fa;
      color: var(--color-primary);
    }
    
    .sync-dropdown-content button:last-child {
      border-bottom: none;
    }

    select {
      padding: 0.5rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-border);
    }

    /* Main Layout */
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .page {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Buttons */
    .btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 600;
      transition: opacity 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:hover { opacity: 0.9; }

    .btn-primary { background-color: var(--color-primary); color: white; }
    .btn-secondary { background-color: #95a5a6; color: white; }
    .btn-danger { background-color: #e74c3c; color: white; }
    .btn-small { padding: 0.4rem 0.8rem; font-size: 0.9rem; }
    
    .btn-group {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn-group .btn.active {
      background-color: var(--color-accent);
      color: white;
    }

    /* Grid Layouts */
    .grid-recipes {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .grid-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    /* Cards */
    .recipe-card, .item-card {
      background: white;
      border-radius: var(--radius-md);
      padding: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      position: relative;
    }

    .recipe-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .recipe-card h3 { margin: 0 0 0.5rem 0; color: var(--color-primary); }
    
    .category-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-right: 0.5rem;
      color: white;
    }
    
    .category-soup { background-color: #e67e22; }
    .category-main { background-color: #27ae60; }
    .category-dessert { background-color: #9b59b6; }
    .category-other { background-color: #7f8c8d; }

    /* Calendar */
    .calendar-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      background: white;
      padding: 1rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
    }

    /* Month View */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background-color: #ddd;
      border: 1px solid #ccc;
      margin-bottom: 2rem;
    }

    .calendar-day-header {
      background: #f0f0f0;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }

    .calendar-day {
      background: white;
      min-height: 120px;
      padding: 8px;
      cursor: pointer;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    .calendar-day:hover {
        background-color: #f9f9f9;
    }

    .calendar-day h4 {
      margin: 0 0 5px 0;
      font-size: 0.9rem;
      color: #666;
      text-align: right;
    }
    
    .calendar-day-content {
        flex: 1;
        overflow-y: auto;
        font-size: 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .mini-recipe-item {
        background-color: var(--color-secondary);
        padding: 2px 4px;
        border-radius: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: var(--color-text-primary);
    }

    /* Week View */
    .week-view {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .week-day-row {
      background: white;
      border-radius: var(--radius-md);
      padding: 1rem;
      box-shadow: var(--shadow-sm);
    }
    
    .week-day-row h3 {
      margin-top: 0;
      color: var(--color-primary);
      border-bottom: 2px solid var(--color-secondary);
      padding-bottom: 0.5rem;
    }

    .week-slots-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .meal-slot {
      background: var(--color-secondary);
      padding: 0.8rem;
      border-radius: var(--radius-sm);
    }

    .calendar-recipe {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      padding: 0.5rem;
      border-radius: 4px;
      margin-top: 0.5rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .calendar-recipe button.remove {
        background: none;
        border: none;
        color: #e74c3c;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0 0.3rem;
    }

    /* Modals */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 2rem;
      width: 90%;
      max-width: 600px;
      border-radius: var(--radius-md);
      position: relative;
    }

    .close {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      box-sizing: border-box;
    }

    .tag-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .tag {
      background: #e9ecef;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .tag.allergen {
      background: #ffe3e3;
      color: #c92a2a;
      border: 1px solid #ffa8a8;
    }
    
    .tag button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
      padding: 0;
      color: inherit;
      opacity: 0.6;
    }
    
    .tag button:hover { opacity: 1; }
    
    .auto-allergens-display {
      background-color: #f8f9fa;
      padding: 0.8rem;
      border-radius: var(--radius-sm);
      border: 1px dashed #ccc;
      min-height: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    /* Template Editor */
    .template-editor-container {
      background: white;
      padding: 2rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
    }
    
    .preview-box {
      border: 1px solid #ddd;
      padding: 2rem;
      margin-top: 2rem;
      background: white;
      min-height: 300px;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: var(--color-text-secondary);
        font-style: italic;
        background: #f8f9fa;
        border-radius: var(--radius-md);
        border: 2px dashed #ddd;
    }
    
    .menu-history-item {
        background: white;
        padding: 1rem;
        margin-bottom: 0.5rem;
        border-radius: var(--radius-sm);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid #eee;
    }

    /* Responsive */
    @media (max-width: 768px) {
      header { flex-direction: column; gap: 1rem; }
      .controls { flex-wrap: wrap; justify-content: center; }
      .calendar { grid-template-columns: 1fr; } 
      .calendar-day { min-height: 80px; }
    }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <span>üë®‚Äçüç≥</span> Recipe Manager
  </div>
  
  <div class="nav-tabs">
    <button class="nav-btn active" data-page="recipes" data-i18n="nav_recipes">Recipes</button>
    <button class="nav-btn" data-page="ingredients" data-i18n="nav_ingredients">Ingredients</button>
    <button class="nav-btn" data-page="allergens" data-i18n="nav_allergens">Allergens</button>
    <button class="nav-btn" data-page="menu" data-i18n="nav_menu">Menu Planning</button>
    <button class="nav-btn" data-page="template" data-i18n="nav_template">Template</button>
  </div>

  <div class="controls">
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="bg">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
    </select>
    
    <div class="sync-dropdown" id="syncDropdown">
      <div class="sync-status" id="syncStatus" onclick="toggleSyncDropdown()">
        üü° Local Storage
      </div>
      <div class="sync-dropdown-content">
        <button onclick="selectSaveLocation()" data-i18n="sync_select_location">üìÅ Select Save Location</button>
        <button onclick="manualSave()" data-i18n="sync_save">üíæ Save Changes</button>
        <button onclick="manualLoad()" data-i18n="sync_load">üìÇ Load from Folder</button>
        <hr style="margin:0;border:0;border-top:1px solid #eee;">
        <button onclick="exportData()" data-i18n="sync_export">‚¨á Export JSON</button>
        <button onclick="document.getElementById('importInput').click()" data-i18n="sync_import">‚¨Ü Import JSON</button>
      </div>
    </div>
    <input type="file" id="importInput" style="display:none" accept=".json">
  </div>
</header>

<div class="container">

  <!-- RECIPES PAGE -->
  <div id="recipes" class="page active">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 data-i18n="nav_recipes">Recipes</h2>
        <button class="btn btn-primary" onclick="openRecipeModal()" data-i18n="btn_add_recipe">+ Add Recipe</button>
    </div>
    <div id="recipeList" class="grid-recipes"></div>
  </div>

  <!-- INGREDIENTS PAGE -->
  <div id="ingredients" class="page">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 data-i18n="nav_ingredients">Ingredients</h2>
        <button class="btn btn-primary" onclick="openIngredientModal()" data-i18n="btn_add_ingredient">+ Add Ingredient</button>
    </div>
    <div id="ingredientList" class="grid-items"></div>
  </div>

  <!-- ALLERGENS PAGE -->
  <div id="allergens" class="page">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 data-i18n="nav_allergens">Allergens</h2>
        <button class="btn btn-primary" onclick="openAllergenModal()" data-i18n="btn_add_allergen">+ Add Allergen</button>
    </div>
    <div id="allergenList" class="grid-items"></div>
  </div>

  <!-- MENU PLANNING PAGE -->
  <div id="menu" class="page">
    <div class="calendar-controls">
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="changeMonth(-1)" data-i18n="btn_previous">‚Üê Previous</button>
        <h3 id="currentMonth" style="margin:0; min-width:200px; text-align:center;"></h3>
        <button class="btn btn-secondary" onclick="changeMonth(1)" data-i18n="btn_next">Next ‚Üí</button>
      </div>
      
      <div class="btn-group">
         <button class="btn btn-secondary" onclick="toggleView('week')" data-i18n="btn_week_view">Week</button>
         <button class="btn btn-secondary" onclick="toggleView('month')" data-i18n="btn_month_view">Month</button>
      </div>

      <div style="display:flex; gap:0.5rem; align-items:center;">
         <label data-i18n="label_print_date">Print Week of:</label>
         <input type="date" id="printStartDate">
         <button class="btn btn-primary" onclick="printMenu()" data-i18n="btn_print">üñ®Ô∏è Print Menu</button>
         <button class="btn btn-secondary" onclick="saveCurrentMenu()" data-i18n="btn_save_menu">üíæ Save Menu</button>
      </div>
    </div>
    
    <div class="alert-info" style="margin-bottom:1rem;font-size:0.9rem;color:#555;" data-i18n="text_print_hint">
      üí° Only days with planned meals will be printed.
    </div>

    <div id="calendar" class="week-view"></div>

    <hr>
    <h3 data-i18n="heading_past_menus">Past Menus</h3>
    <div id="menuHistory"></div>
  </div>

  <!-- TEMPLATE PAGE -->
  <div id="template" class="page">
    <h2 data-i18n="nav_template">Print Template</h2>
    
    <div class="template-editor-container">
      <p data-i18n="template_description">Customize your menu print template.</p>
      
      <div style="margin-bottom:1rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
        <button class="btn btn-small btn-secondary" onclick="insertVariable('{title}')">Title</button>
        <button class="btn btn-small btn-secondary" onclick="insertVariable('{dateRange}')">Date Range</button>
        <button class="btn btn-small btn-secondary" onclick="insertVariable('{recipes}')">Recipes Grid</button>
        <button class="btn btn-small btn-secondary" onclick="insertVariable('{labelMenuFor}')">Label 'Menu For'</button>
      </div>
      
      <div style="margin-bottom:1rem; border-top:1px solid #eee; padding-top:1rem;">
        <h4 data-i18n="label_layout">Layout Style</h4>
        <div class="btn-group">
             <button class="btn btn-small btn-secondary" id="layout_default" data-i18n="btn_layout_default">Default</button>
             <button class="btn btn-small btn-secondary" id="layout_columns" data-i18n="btn_layout_columns">Two Columns</button>
             <button class="btn btn-small btn-secondary" id="layout_centered" data-i18n="btn_layout_centered">Centered</button>
             <button class="btn btn-small btn-secondary" id="layout_grid" data-i18n="btn_layout_grid">5-Day Grid</button>
        </div>
      </div>
      
      <div style="margin-bottom:1rem;">
         <h4 data-i18n="label_background">Background Image</h4>
         <input type="file" id="uploadBgInput" accept="image/*">
         <button class="btn btn-small btn-danger" id="removeBgBtn" data-i18n="btn_remove_bg">Remove BG</button>
      </div>

      <div id="templateEditor"></div>
      
      <button class="btn btn-primary" style="margin-top:1rem;" onclick="saveTemplate()" data-i18n="btn_save_template">Save Template</button>
    </div>

    <h3 data-i18n="heading_preview">Preview</h3>
    <div id="templatePreview" class="preview-box"></div>
  </div>

</div>

<!-- RECIPE MODAL -->
<div id="recipeModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeRecipeModal()">&times;</span>
    <h2 id="recipeModalTitle" data-i18n="modal_add_recipe">Add Recipe</h2>
    <form id="recipeForm" onsubmit="saveRecipe(event)">
      
      <div class="form-group">
        <label data-i18n="label_recipe_name">Recipe Name</label>
        <input type="text" id="recipeName" required>
      </div>

      <div class="form-group">
        <label data-i18n="label_category">Category</label>
        <select id="recipeCategory" required>
          <!-- Options populated by JS -->
        </select>
      </div>

      <div class="form-group">
        <label data-i18n="label_portion_size">Portion Size</label>
        <input type="text" id="recipePortionSize">
      </div>

      <div class="form-group">
        <label data-i18n="label_ingredients">Ingredients</label>
        <div style="display:flex; gap:0.5rem;">
          <select id="ingredientSelect"></select>
          <button type="button" class="btn btn-secondary" onclick="addIngredientToRecipe()" data-i18n="btn_add">Add</button>
        </div>
        <div id="recipeIngredients" class="tag-container"></div>
      </div>

      <div class="form-group">
        <label data-i18n="label_auto_allergens">Auto-Detected Allergens (from ingredients)</label>
        <div id="recipeAutoAllergens" class="auto-allergens-display">
            <!-- Populated automatically -->
        </div>
      </div>

      <div class="form-group">
        <label data-i18n="label_manual_allergens">Additional / Manual Allergens</label>
        <div style="display:flex; gap:0.5rem;">
          <select id="allergenSelect"></select>
          <button type="button" class="btn btn-secondary" onclick="addManualAllergenToRecipe()" data-i18n="btn_add">Add</button>
        </div>
        <div id="recipeManualAllergens" class="tag-container"></div>
      </div>

      <div class="form-group">
        <label data-i18n="label_instructions">Instructions</label>
        <textarea id="recipeInstructions" rows="4"></textarea>
      </div>

      <button type="submit" class="btn btn-primary" data-i18n="btn_save_recipe">Save Recipe</button>
    </form>
  </div>
</div>

<!-- INGREDIENT MODAL -->
<div id="ingredientModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeIngredientModal()">&times;</span>
    <h2 data-i18n="modal_add_ingredient">Add Ingredient</h2>
    <form id="ingredientForm" onsubmit="saveIngredient(event)">
      <div class="form-group">
        <label data-i18n="label_ingredient_name">Ingredient Name</label>
        <input type="text" id="ingredientName" required>
      </div>
      
      <div class="form-group">
          <label data-i18n="label_linked_allergens">Contains Allergens:</label>
          <div style="display:flex; gap:0.5rem;">
              <select id="ingredientAllergenSelect"></select>
              <button type="button" class="btn btn-secondary" onclick="addLinkedAllergen()" data-i18n="btn_add">Add</button>
          </div>
          <div id="ingredientLinkedAllergens" class="tag-container"></div>
          <p style="font-size:0.8rem; color:#666; margin-top:0.5rem;">
              * Allergens linked here will automatically appear on any recipe using this ingredient.
          </p>
      </div>

      <button type="submit" class="btn btn-primary" data-i18n="btn_save_ingredient">Save Ingredient</button>
    </form>
  </div>
</div>

<!-- ALLERGEN MODAL -->
<div id="allergenModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeAllergenModal()">&times;</span>
    <h2 data-i18n="modal_add_allergen">Add Allergen</h2>
    <form id="allergenForm" onsubmit="saveAllergen(event)">
      <div class="form-group">
        <label data-i18n="label_allergen_name">Allergen Name</label>
        <input type="text" id="allergenName" required>
      </div>
      <div class="form-group">
        <label data-i18n="label_color">Color Tag</label>
        <input type="color" id="allergenColor" value="#ff0000" style="height:40px; padding:0;">
      </div>
      <button type="submit" class="btn btn-primary" data-i18n="btn_save_allergen">Save Allergen</button>
    </form>
  </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-lite.min.js"></script>
<script src="app.js"></script>

</body>
</html>