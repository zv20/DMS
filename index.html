<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Summernote Editor (100% Free, No API Key) -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçΩÔ∏è Recipe Manager</h1>
            <div class="header-controls">
                <div id="syncStatus" class="sync-status disconnected">Not Connected</div>
                <select id="languageSelect" onchange="changeLanguage(this.value)">
                    <option value="en">English</option>
                    <option value="bg">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
                </select>
            </div>
        </header>

        <nav>
            <button class="nav-btn active" data-page="recipes">Recipes</button>
            <button class="nav-btn" data-page="ingredients">Ingredients</button>
            <button class="nav-btn" data-page="allergens">Allergens</button>
            <button class="nav-btn" data-page="menu">Menu Planning</button>
            <button class="nav-btn" data-page="template">Print Template</button>
        </nav>

        <!-- File System Controls -->
        <div class="file-controls">
            <button class="btn btn-primary" onclick="selectSaveLocation()">üìÅ Select Save Location</button>
            <button class="btn btn-secondary" onclick="manualSave()">üíæ Save</button>
            <button class="btn btn-secondary" onclick="manualLoad()">üìÇ Load from Folder</button>
            <button class="btn btn-secondary" onclick="exportData()">Export</button>
            <button class="btn btn-secondary" onclick="importData()">Import</button>
        </div>

        <!-- Recipes Page -->
        <div id="recipes" class="page active">
            <div class="page-header">
                <h2>Recipes</h2>
                <button class="btn btn-primary" onclick="openRecipeModal()">+ Add Recipe</button>
            </div>
            <div id="recipeList" class="card-grid"></div>
        </div>

        <!-- Ingredients Page -->
        <div id="ingredients" class="page">
            <div class="page-header">
                <h2>Ingredients</h2>
                <button class="btn btn-primary" onclick="openIngredientModal()">+ Add Ingredient</button>
            </div>
            <div id="ingredientList" class="card-grid"></div>
        </div>

        <!-- Allergens Page -->
        <div id="allergens" class="page">
            <div class="page-header">
                <h2>Allergens</h2>
                <button class="btn btn-primary" onclick="openAllergenModal()">+ Add Allergen</button>
            </div>
            <div id="allergenList" class="card-grid"></div>
        </div>

        <!-- Menu Planning Page -->
        <div id="menu" class="page">
            <div class="page-header">
                <h2>Menu Planning</h2>
                <div class="menu-controls">
                    <button class="btn btn-secondary" onclick="toggleView('week')">üìÖ Week View</button>
                    <button class="btn btn-secondary" onclick="toggleView('month')">üìÜ Month View</button>
                    <button class="btn btn-primary" onclick="saveCurrentMenu()">Save Menu</button>
                </div>
            </div>

            <!-- Day Selection for Printing -->
            <div style="background:var(--color-surface);padding:1rem;border-radius:var(--border-radius);margin-bottom:1.5rem;box-shadow:var(--shadow-sm);">
                <h4 style="margin:0 0 0.75rem 0;color:var(--color-text);">üìÖ Select Days to Print:</h4>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                    <button id="printDay0" class="btn btn-small btn-secondary day-selector" onclick="togglePrintDay(0)">Sun</button>
                    <button id="printDay1" class="btn btn-small btn-secondary day-selector active" onclick="togglePrintDay(1)">Mon</button>
                    <button id="printDay2" class="btn btn-small btn-secondary day-selector active" onclick="togglePrintDay(2)">Tue</button>
                    <button id="printDay3" class="btn btn-small btn-secondary day-selector active" onclick="togglePrintDay(3)">Wed</button>
                    <button id="printDay4" class="btn btn-small btn-secondary day-selector active" onclick="togglePrintDay(4)">Thu</button>
                    <button id="printDay5" class="btn btn-small btn-secondary day-selector active" onclick="togglePrintDay(5)">Fri</button>
                    <button id="printDay6" class="btn btn-small btn-secondary day-selector" onclick="togglePrintDay(6)">Sat</button>
                    <button class="btn btn-primary" onclick="printMenu()" style="margin-left:auto;">üñ®Ô∏è Print Selected Days</button>
                </div>
                <p style="margin:0.75rem 0 0 0;font-size:0.875rem;color:var(--color-text-secondary);">
                    üí° Click days to toggle selection. Only selected days will appear in the printed menu.
                </p>
            </div>

            <div class="calendar-header">
                <button class="btn btn-secondary" onclick="changeMonth(-1)">‚Üê Previous</button>
                <h3 id="currentMonth"></h3>
                <button class="btn btn-secondary" onclick="changeMonth(1)">Next ‚Üí</button>
            </div>
            <div id="calendar" class="calendar"></div>

            <div class="menu-history-section">
                <h3>Past Menus</h3>
                <div id="menuHistory"></div>
            </div>
        </div>

        <!-- Print Template Page -->
        <div id="template" class="page">
            <div class="page-header">
                <h2>Print Template Designer</h2>
                <button class="btn btn-primary" onclick="saveTemplate()">Save Template</button>
            </div>

            <div class="template-editor-container">
                <div class="template-editor-section">
                    <h3>Template Editor</h3>
                    <p style="color:var(--color-text-secondary);font-size:0.9rem;margin-bottom:0.5rem;">
                        Customize your menu print template. Insert variables using the buttons below:
                    </p>

                    <div style="background:#e3f2fd;padding:1rem;border-radius:var(--border-radius);margin-bottom:1rem;border-left:4px solid var(--color-primary);">
                        <h4 style="margin:0 0 0.5rem 0;color:var(--color-primary);">üìù Available Variables:</h4>
                        <ul style="margin:0;padding-left:1.5rem;font-size:0.875rem;line-height:1.8;">
                            <li><code>{title}</code> - Menu title with date range</li>
                            <li><code>{dateRange}</code> - Selected date range</li>
                            <li><code>{labelMenuFor}</code> - "Menu for:" label</li>
                            <li><code>{recipes}</code> - <strong>All recipes organized by day and meal type</strong></li>
                        </ul>
                        <p style="margin:0.75rem 0 0 0;font-size:0.85rem;color:#1976d2;">
                            üí° <strong>Tip:</strong> The <code>{recipes}</code> variable automatically formats your menu with:
                            <br>‚Ä¢ Day names (e.g., "Monday, February 10")
                            <br>‚Ä¢ Meal categories (Soups, Main Dishes, Desserts, Other)
                            <br>‚Ä¢ Recipe names with allergen warnings
                            <br>‚Ä¢ Only shows recipes from days you select for printing
                        </p>
                    </div>

                    <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
                        <button class="btn btn-small btn-secondary" onclick="insertVariable('{title}')">Insert {title}</button>
                        <button class="btn btn-small btn-secondary" onclick="insertVariable('{dateRange}')">Insert {dateRange}</button>
                        <button class="btn btn-small btn-secondary" onclick="insertVariable('{labelMenuFor}')">Insert {labelMenuFor}</button>
                        <button class="btn btn-small btn-primary" onclick="insertVariable('{recipes}')">Insert {recipes}</button>
                    </div>

                    <div id="templateEditor"></div>

                    <div style="margin-top:1.5rem;">
                        <h4>Layout Style</h4>
                        <div style="display:flex;gap:0.5rem;margin-top:0.5rem;flex-wrap:wrap;">
                            <button class="btn btn-small btn-secondary layout-btn active" onclick="setLayout('default')">üìÑ Default</button>
                            <button class="btn btn-small btn-secondary layout-btn" onclick="setLayout('columns')">üì∞ Two Columns</button>
                            <button class="btn btn-small btn-secondary layout-btn" onclick="setLayout('centered')">‚≠ê Centered</button>
                        </div>
                    </div>

                    <div style="margin-top:1.5rem;">
                        <h4>Background Image</h4>
                        <div style="display:flex;gap:0.5rem;margin-top:0.5rem;flex-wrap:wrap;">
                            <button class="btn btn-small btn-secondary" onclick="uploadBackgroundImage()">üñºÔ∏è Upload Background</button>
                            <button class="btn btn-small btn-danger" onclick="removeBackgroundImage()">‚úñ Remove Background</button>
                        </div>
                    </div>
                </div>

                <div class="template-preview-section">
                    <h3>Preview</h3>
                    <p style="color:var(--color-text-secondary);font-size:0.85rem;margin-bottom:1rem;">
                        Shows how your menu will look with selected days (first 2 days shown in preview)
                    </p>
                    <div id="templatePreview" class="template-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recipe Modal -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="recipeModalTitle">Add Recipe</h2>
                <button class="modal-close" onclick="closeRecipeModal()">&times;</button>
            </div>
            <form id="recipeForm" onsubmit="saveRecipe(event)">
                <div class="form-group">
                    <label for="recipeName">Recipe Name</label>
                    <input type="text" id="recipeName" required>
                </div>

                <div class="form-group">
                    <label for="recipeCategory">Category</label>
                    <select id="recipeCategory" required>
                        <option value="">Select category</option>
                        <option value="soup">ü•£ Soup</option>
                        <option value="main">üçΩÔ∏è Main</option>
                        <option value="dessert">üç∞ Dessert</option>
                        <option value="other">‚ûï Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="recipePortionSize">Portion Size (optional)</label>
                    <input type="text" id="recipePortionSize" placeholder="e.g., Serves 10, 250g per serving">
                </div>

                <div class="form-group">
                    <label>Ingredients</label>
                    <div style="display:flex;gap:0.5rem;margin-bottom:0.5rem;">
                        <select id="ingredientSelect" style="flex:1;">
                            <option value="">Select ingredient</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="addIngredientToRecipe()">Add</button>
                    </div>
                    <div id="recipeIngredients" class="tag-container"></div>
                </div>

                <div class="form-group">
                    <label>Allergens</label>
                    <div style="display:flex;gap:0.5rem;margin-bottom:0.5rem;">
                        <select id="allergenSelect" style="flex:1;">
                            <option value="">Select allergen</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="addAllergenToRecipe()">Add</button>
                    </div>
                    <div id="recipeAllergens" class="tag-container"></div>
                </div>

                <div class="form-group">
                    <label for="recipeInstructions">Instructions (optional)</label>
                    <textarea id="recipeInstructions" rows="4"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeRecipeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Recipe</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ingredient Modal -->
    <div id="ingredientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Ingredient</h2>
                <button class="modal-close" onclick="closeIngredientModal()">&times;</button>
            </div>
            <form id="ingredientForm" onsubmit="saveIngredient(event)">
                <div class="form-group">
                    <label for="ingredientName">Ingredient Name</label>
                    <input type="text" id="ingredientName" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeIngredientModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Allergen Modal -->
    <div id="allergenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Allergen</h2>
                <button class="modal-close" onclick="closeAllergenModal()">&times;</button>
            </div>
            <form id="allergenForm" onsubmit="saveAllergen(event)">
                <div class="form-group">
                    <label for="allergenName">Allergen Name</label>
                    <input type="text" id="allergenName" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAllergenModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>